<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Tarea 1 - 1EST17</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/quarto.js"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="index_files/libs/quarto-html/anchor.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="index_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Tabla de Contenidos</h2>
   
  <ul>
  <li><a href="#grupo" id="toc-grupo" class="nav-link active" data-scroll-target="#grupo">Grupo</a></li>
  <li><a href="#problema-1" id="toc-problema-1" class="nav-link" data-scroll-target="#problema-1">Problema 1</a>
  <ul class="collapse">
  <li><a href="#pregunta-a" id="toc-pregunta-a" class="nav-link" data-scroll-target="#pregunta-a">Pregunta a</a></li>
  <li><a href="#pregunta-b" id="toc-pregunta-b" class="nav-link" data-scroll-target="#pregunta-b">Pregunta b</a></li>
  <li><a href="#pregunta-c" id="toc-pregunta-c" class="nav-link" data-scroll-target="#pregunta-c">Pregunta c</a></li>
  <li><a href="#pregunta-d" id="toc-pregunta-d" class="nav-link" data-scroll-target="#pregunta-d">Pregunta d</a></li>
  <li><a href="#pregunta-e" id="toc-pregunta-e" class="nav-link" data-scroll-target="#pregunta-e">Pregunta e</a></li>
  <li><a href="#pregunta-f" id="toc-pregunta-f" class="nav-link" data-scroll-target="#pregunta-f">Pregunta f</a></li>
  <li><a href="#pregunta-g" id="toc-pregunta-g" class="nav-link" data-scroll-target="#pregunta-g">Pregunta g</a></li>
  <li><a href="#pregunta-h" id="toc-pregunta-h" class="nav-link" data-scroll-target="#pregunta-h">Pregunta h</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Tarea 1 - 1EST17</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="grupo" class="level2">
<h2 class="anchored" data-anchor-id="grupo">Grupo</h2>
<ul>
<li><strong>Integrante</strong>: Lucio Enrique Cornejo Ramírez</li>
<li><strong>Código</strong>: 20192058</li>
</ul>
</section>
<section id="problema-1" class="level2">
<h2 class="anchored" data-anchor-id="problema-1">Problema 1</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ISLR2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'ISLR2' was built under R version 4.1.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Weekly)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Weekly)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Year   Lag1   Lag2   Lag3   Lag4   Lag5    Volume  Today Direction
1 1990  0.816  1.572 -3.936 -0.229 -3.484 0.1549760 -0.270      Down
2 1990 -0.270  0.816  1.572 -3.936 -0.229 0.1485740 -2.576      Down
3 1990 -2.576 -0.270  0.816  1.572 -3.936 0.1598375  3.514        Up
4 1990  3.514 -2.576 -0.270  0.816  1.572 0.1616300  0.712        Up
5 1990  0.712  3.514 -2.576 -0.270  0.816 0.1537280  1.178        Up
6 1990  1.178  0.712  3.514 -2.576 -0.270 0.1544440 -1.372      Down</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(Weekly)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   1089 obs. of  9 variables:
 $ Year     : num  1990 1990 1990 1990 1990 1990 1990 1990 1990 1990 ...
 $ Lag1     : num  0.816 -0.27 -2.576 3.514 0.712 ...
 $ Lag2     : num  1.572 0.816 -0.27 -2.576 3.514 ...
 $ Lag3     : num  -3.936 1.572 0.816 -0.27 -2.576 ...
 $ Lag4     : num  -0.229 -3.936 1.572 0.816 -0.27 ...
 $ Lag5     : num  -3.484 -0.229 -3.936 1.572 0.816 ...
 $ Volume   : num  0.155 0.149 0.16 0.162 0.154 ...
 $ Today    : num  -0.27 -2.576 3.514 0.712 1.178 ...
 $ Direction: Factor w/ 2 levels "Down","Up": 1 1 2 2 2 1 2 2 2 1 ...</code></pre>
</div>
</div>
<p>Trataremos la categoría <code>Up</code> como valor <em>exitoso</em> de la variable <code>Direction</code> por predecir.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>Weekly<span class="sc">$</span>Direction <span class="ot">&lt;-</span> <span class="fu">relevel</span>(Weekly<span class="sc">$</span>Direction, <span class="st">"Down"</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Weekly)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Year   Lag1   Lag2   Lag3   Lag4   Lag5    Volume  Today Direction
1 1990  0.816  1.572 -3.936 -0.229 -3.484 0.1549760 -0.270      Down
2 1990 -0.270  0.816  1.572 -3.936 -0.229 0.1485740 -2.576      Down
3 1990 -2.576 -0.270  0.816  1.572 -3.936 0.1598375  3.514        Up
4 1990  3.514 -2.576 -0.270  0.816  1.572 0.1616300  0.712        Up
5 1990  0.712  3.514 -2.576 -0.270  0.816 0.1537280  1.178        Up
6 1990  1.178  0.712  3.514 -2.576 -0.270 0.1544440 -1.372      Down</code></pre>
</div>
</div>
<section id="pregunta-a" class="level3">
<h3 class="anchored" data-anchor-id="pregunta-a">Pregunta a</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>modelo_logistic <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  Direction <span class="sc">~</span> Lag1 <span class="sc">+</span> Lag2 <span class="sc">+</span> Lag3 <span class="sc">+</span> Lag4 <span class="sc">+</span> Lag5 <span class="sc">+</span> Volume, </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> binomial, <span class="at">data =</span> Weekly</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modelo_logistic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = Direction ~ Lag1 + Lag2 + Lag3 + Lag4 + Lag5 + 
    Volume, family = binomial, data = Weekly)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.6949  -1.2565   0.9913   1.0849   1.4579  

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)   
(Intercept)  0.26686    0.08593   3.106   0.0019 **
Lag1        -0.04127    0.02641  -1.563   0.1181   
Lag2         0.05844    0.02686   2.175   0.0296 * 
Lag3        -0.01606    0.02666  -0.602   0.5469   
Lag4        -0.02779    0.02646  -1.050   0.2937   
Lag5        -0.01447    0.02638  -0.549   0.5833   
Volume      -0.02274    0.03690  -0.616   0.5377   
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1496.2  on 1088  degrees of freedom
Residual deviance: 1486.4  on 1082  degrees of freedom
AIC: 1500.4

Number of Fisher Scoring iterations: 4</code></pre>
</div>
</div>
<p>De la columna <code>Pr(&gt;|z|)</code> en la tabla previa, notamos que solo la variable <code>Lag2</code> parece ser estadísticamente significativa en el modelo, puesto que presenta un p-valor asociado de <code>0.0296</code>, menor que <strong>0.05</strong>.</p>
</section>
<section id="pregunta-b" class="level3">
<h3 class="anchored" data-anchor-id="pregunta-b">Pregunta b</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Probabilidades predichas</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>yprob <span class="ot">&lt;-</span> <span class="fu">predict</span>(modelo_logistic, <span class="at">type =</span> <span class="st">'response'</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(yprob)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        1         2         3         4         5         6 
0.6086249 0.6010314 0.5875699 0.4816416 0.6169013 0.5684190 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Valores predichos</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>ypred <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">as.numeric</span>(yprob <span class="sc">&gt;=</span> <span class="fl">0.5</span>), <span class="at">labels =</span> <span class="fu">levels</span>(Weekly<span class="sc">$</span>Direction))</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ypred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] Up   Up   Up   Down Up   Up  
Levels: Down Up</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Matriz de confusión</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">confusionMatrix</span>(</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> ypred, <span class="at">reference =</span> Weekly<span class="sc">$</span>Direction, </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fijamos la categoría "Up" de la variable </span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># por predecir (Direction), como el valor de éxito</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">positive =</span> <span class="st">"Up"</span>, <span class="at">mode =</span> <span class="st">"everything"</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>          Reference
Prediction  Up Down
      Up   557  430
      Down  48   54</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>$overall
      Accuracy          Kappa  AccuracyLower  AccuracyUpper   AccuracyNull 
  5.610652e-01   3.499327e-02   5.310002e-01   5.907994e-01   5.555556e-01 
AccuracyPValue  McnemarPValue 
  3.690448e-01   5.189745e-68 

$byClass
         Sensitivity          Specificity       Pos Pred Value 
           0.9206612            0.1115702            0.5643364 
      Neg Pred Value            Precision               Recall 
           0.5294118            0.5643364            0.9206612 
                  F1           Prevalence       Detection Rate 
           0.6997487            0.5555556            0.5114784 
Detection Prevalence    Balanced Accuracy 
           0.9063361            0.5161157 </code></pre>
</div>
</div>
<p><strong>Interpretación de las métricas halladas</strong>:</p>
<table class="table">
<colgroup>
<col style="width: 35%">
<col style="width: 35%">
<col style="width: 28%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Métrica</th>
<th style="text-align: center;">Valor</th>
<th style="text-align: left;">Interpretación</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Accuracy</td>
<td style="text-align: center;">0.5611</td>
<td style="text-align: left;">Aproximadamente <span class="math inline">\(56\%\)</span> de las observaciones fueron clasificadas correctamente por el modelo.</td>
</tr>
<tr class="even">
<td style="text-align: center;">Coeficiente Kappa</td>
<td style="text-align: center;">0.035</td>
<td style="text-align: left;">Como el coeficiente de Kappa es positivo, pero tan cercano a cero, concluimos que el <strong>grado de acuerdo</strong> entre los valores de reales y los predichos por el modelo es insignificante. Es decir, las predicciones del modelo son casi tan precisas como si se predijese por simple azar.</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Sensibilidad</td>
<td style="text-align: center;">0.9207</td>
<td style="text-align: left;">El modelo predice correctamente aproximadamente <span class="math inline">\(92\%\)</span> de los casos positivos (mercado tuvo rendimiento positivo en una semana) .</td>
</tr>
<tr class="even">
<td style="text-align: center;">Especificidad</td>
<td style="text-align: center;">0.1116</td>
<td style="text-align: left;">El modelo predice correctamente aproximadamente <span class="math inline">\(11\%\)</span> de los casos negativos (mercado tuvo rendimiento negativo en una semana) .</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Índice de Youden</td>
<td style="text-align: center;">0.0323</td>
<td style="text-align: left;">Como el índide de Youden es tan cercano a cero, esto implica que el modelo genera aproximadamente la misma proporción de predicciones <em>positivas/éxito</em> para observaciones exitosas y observaciones no exitosas. Es decir, este modelo es prácticamente inútil.</td>
</tr>
<tr class="even">
<td style="text-align: center;">Precisión</td>
<td style="text-align: center;">0.5643</td>
<td style="text-align: left;">Este modelo produce una probabilidad de aproximadamente <span class="math inline">\(56\%\)</span> de que una observación predicha como positiva/exitosa, realmente sea positiva/exitosa.</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Prevalencia</td>
<td style="text-align: center;">0.5556</td>
<td style="text-align: left;">Se estima que, en la población asociada al conjunto de datos <code>Weekly</code>, aproximadamente <span class="math inline">\(56\%\)</span> de las instancias sean positivas (rendimiento positivo semanal del mercado).</td>
</tr>
<tr class="even">
<td style="text-align: center;">PPV</td>
<td style="text-align: center;">0.5643</td>
<td style="text-align: left;">Según este modelo, la probabilidad de que una observación sea positiva (mercado haya tenido rendimiento positivo en una semana arbitraria entre 1990 y 2010) es de aproximadamente <span class="math inline">\(56\%\)</span> .</td>
</tr>
<tr class="odd">
<td style="text-align: center;">NPV</td>
<td style="text-align: center;">0.5294</td>
<td style="text-align: left;">Según este modelo, la probabilidad de que una observación sea negativa (mercado haya tenido rendimiento negativo en una semana arbitraria entre 1990 y 2010) es de aproximadamente <span class="math inline">\(53\%\)</span> .</td>
</tr>
</tbody>
</table>
</section>
<section id="pregunta-c" class="level3">
<h3 class="anchored" data-anchor-id="pregunta-c">Pregunta c</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pROC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'pROC' was built under R version 4.1.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Type 'citation("pROC")' for a citation.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'pROC'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    cov, smooth, var</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(Weekly<span class="sc">$</span>Direction)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Down" "Up"  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>analysis <span class="ot">&lt;-</span> <span class="fu">roc</span>(<span class="at">response =</span> Weekly<span class="sc">$</span>Direction, <span class="at">predictor =</span> yprob)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Curva ROC</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span> <span class="sc">-</span> analysis<span class="sc">$</span>specificities, analysis<span class="sc">$</span>sensitivities,</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">"Sensitividad"</span>, <span class="at">xlab =</span> <span class="st">"1 - Especificidad"</span>,</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">"Curva ROC para el modelo logístico"</span>,</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">2</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a =</span> <span class="dv">0</span>, <span class="at">b =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Notamos que la curva ROC del modelo está <strong>muy alejada</strong> del caso ideal. Es decir, los puntos de la curva ROC del modelo están lejos de la esquina superior izquierda, la cual representa el caso de un modelo perfecto, donde la sensitividad y especificidad son máximas (valen 1).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Área bajo la curva</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>analysis<span class="sc">$</span>auc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Area under the curve: 0.5537</code></pre>
</div>
</div>
<p>Como el área bajo la curva ROC es de <span class="math inline">\(0.5537\)</span>, un valor muy cercano a <span class="math inline">\(0.5\)</span>, concluimos que este modelo <strong>no predice adecuadamente</strong> si una observación arbitraria posee un valor positivo/exitoso de clase/Direction.</p>
</section>
<section id="pregunta-d" class="level3">
<h3 class="anchored" data-anchor-id="pregunta-d">Pregunta d</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Hallamos el punto de corte óptimo para un balance </span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co"># entre sensibilidad y especificidad del modelo</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>e <span class="ot">&lt;-</span> <span class="fu">cbind</span>(</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  analysis<span class="sc">$</span>thresholds,</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  analysis<span class="sc">$</span>sensitivities <span class="sc">+</span> analysis<span class="sc">$</span>specificities <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(e)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          [,1]          [,2]
[1,]      -Inf  0.0000000000
[2,] 0.2986107  0.0020661157
[3,] 0.3281353  0.0041322314
[4,] 0.3525944  0.0024793388
[5,] 0.3778156  0.0008264463
[6,] 0.3992318 -0.0008264463</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>opt_t <span class="ot">&lt;-</span> <span class="fu">subset</span>(e, e[,<span class="dv">2</span>] <span class="sc">==</span> <span class="fu">max</span>(e[,<span class="dv">2</span>]))[,<span class="dv">1</span>]</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>opt_t</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5436289</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>ypred2 <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">as.numeric</span>(yprob <span class="sc">&gt;=</span> opt_t ), <span class="at">labels =</span> <span class="fu">levels</span>(Weekly<span class="sc">$</span>Direction))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Nueva matriz de confusión</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>tmp2 <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">confusionMatrix</span>(</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> ypred2, <span class="at">reference =</span> Weekly<span class="sc">$</span>Direction, </span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">positive =</span> <span class="st">"Up"</span>, <span class="at">mode =</span> <span class="st">"everything"</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>          Reference
Prediction  Up Down
      Up   405  277
      Down 200  207</code></pre>
</div>
</div>
<p>Comparamos las métricas del nuevo modelo (solo cambiamos el punto de corte):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>metricas_modelos <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="fu">as.list</span>(<span class="fu">c</span>(tmp[[<span class="dv">3</span>]], tmp[[<span class="dv">4</span>]])), <span class="at">row.names =</span> <span class="st">"Modelo 1"</span>),</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="fu">as.list</span>(<span class="fu">c</span>(tmp2[[<span class="dv">3</span>]], tmp2[[<span class="dv">4</span>]])), <span class="at">row.names =</span> <span class="st">"Modelo 2"</span>)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">t</span>(metricas_modelos))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">Modelo 1</th>
<th style="text-align: right;">Modelo 2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Accuracy</td>
<td style="text-align: right;">0.5610652</td>
<td style="text-align: right;">0.5619835</td>
</tr>
<tr class="even">
<td style="text-align: left;">Kappa</td>
<td style="text-align: right;">0.0349933</td>
<td style="text-align: right;">0.0986773</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AccuracyLower</td>
<td style="text-align: right;">0.5310002</td>
<td style="text-align: right;">0.5319228</td>
</tr>
<tr class="even">
<td style="text-align: left;">AccuracyUpper</td>
<td style="text-align: right;">0.5907994</td>
<td style="text-align: right;">0.5917084</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AccuracyNull</td>
<td style="text-align: right;">0.5555556</td>
<td style="text-align: right;">0.5555556</td>
</tr>
<tr class="even">
<td style="text-align: left;">AccuracyPValue</td>
<td style="text-align: right;">0.3690448</td>
<td style="text-align: right;">0.3462681</td>
</tr>
<tr class="odd">
<td style="text-align: left;">McnemarPValue</td>
<td style="text-align: right;">0.0000000</td>
<td style="text-align: right;">0.0005018</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sensitivity</td>
<td style="text-align: right;">0.9206612</td>
<td style="text-align: right;">0.6694215</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Specificity</td>
<td style="text-align: right;">0.1115702</td>
<td style="text-align: right;">0.4276860</td>
</tr>
<tr class="even">
<td style="text-align: left;">Pos.Pred.Value</td>
<td style="text-align: right;">0.5643364</td>
<td style="text-align: right;">0.5938416</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Neg.Pred.Value</td>
<td style="text-align: right;">0.5294118</td>
<td style="text-align: right;">0.5085995</td>
</tr>
<tr class="even">
<td style="text-align: left;">Precision</td>
<td style="text-align: right;">0.5643364</td>
<td style="text-align: right;">0.5938416</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Recall</td>
<td style="text-align: right;">0.9206612</td>
<td style="text-align: right;">0.6694215</td>
</tr>
<tr class="even">
<td style="text-align: left;">F1</td>
<td style="text-align: right;">0.6997487</td>
<td style="text-align: right;">0.6293706</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Prevalence</td>
<td style="text-align: right;">0.5555556</td>
<td style="text-align: right;">0.5555556</td>
</tr>
<tr class="even">
<td style="text-align: left;">Detection.Rate</td>
<td style="text-align: right;">0.5114784</td>
<td style="text-align: right;">0.3719008</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Detection.Prevalence</td>
<td style="text-align: right;">0.9063361</td>
<td style="text-align: right;">0.6262626</td>
</tr>
<tr class="even">
<td style="text-align: left;">Balanced.Accuracy</td>
<td style="text-align: right;">0.5161157</td>
<td style="text-align: right;">0.5485537</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><strong>Conclusiones respecto a la tabla previa</strong>:</p>
<ul>
<li>El segundo modelo posee una <strong>ligeramente mayor accuracy</strong>.</li>
<li>Pese al incremento del coeficiente de Kappa, el nuevo valor, <span class="math inline">\(0.099\)</span> es aún tan cercano a cero que el <strong>grado de acuerdo</strong> entre los valores reales y predichos por el nuevo modelo es aún <strong>insignificante</strong>.</li>
<li>Debido al balance entre sensibilidad y especificidad, el nuevo modelo posee una <strong>mayor especificidad</strong>, pero <strong>menor sensibilidad</strong>.</li>
<li>Ambos modelos poseen la <strong>misma prevalencia</strong>, puesto que este valor depende de los datos (muestra); no del modelo.</li>
<li>Como se está realizando una clasificación <strong>binaria</strong>, el <strong>aumento de PPV</strong> produjo un <strong>menor NPV</strong> para el nuevo modelo.</li>
</ul>
</section>
<section id="pregunta-e" class="level3">
<h3 class="anchored" data-anchor-id="pregunta-e">Pregunta e</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Weekly<span class="sc">$</span>Year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   1990    1995    2000    2000    2005    2010 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>split_train_validation <span class="ot">&lt;-</span> Weekly<span class="sc">$</span>Year <span class="sc">&lt;</span> <span class="dv">2009</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Esquema de validación</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>training_set <span class="ot">&lt;-</span> Weekly[split_train_validation,]</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(training_set)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Year   Lag1   Lag2   Lag3   Lag4   Lag5    Volume  Today Direction
1 1990  0.816  1.572 -3.936 -0.229 -3.484 0.1549760 -0.270      Down
2 1990 -0.270  0.816  1.572 -3.936 -0.229 0.1485740 -2.576      Down
3 1990 -2.576 -0.270  0.816  1.572 -3.936 0.1598375  3.514        Up
4 1990  3.514 -2.576 -0.270  0.816  1.572 0.1616300  0.712        Up
5 1990  0.712  3.514 -2.576 -0.270  0.816 0.1537280  1.178        Up
6 1990  1.178  0.712  3.514 -2.576 -0.270 0.1544440 -1.372      Down</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>validation_set <span class="ot">&lt;-</span> Weekly[<span class="sc">!</span>split_train_validation,]</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(validation_set)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Year   Lag1   Lag2   Lag3   Lag4   Lag5   Volume  Today Direction
986 2009  6.760 -1.698  0.926  0.418 -2.251 3.793110 -4.448      Down
987 2009 -4.448  6.760 -1.698  0.926  0.418 5.043904 -4.518      Down
988 2009 -4.518 -4.448  6.760 -1.698  0.926 5.948758 -2.137      Down
989 2009 -2.137 -4.518 -4.448  6.760 -1.698 6.129763 -0.730      Down
990 2009 -0.730 -2.137 -4.518 -4.448  6.760 5.602004  5.173        Up
991 2009  5.173 -0.730 -2.137 -4.518 -4.448 6.217632 -4.808      Down</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>modelo_logistic3 <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  Direction <span class="sc">~</span> Lag2, <span class="at">family =</span> binomial, <span class="at">data =</span> training_set</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modelo_logistic3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = Direction ~ Lag2, family = binomial, data = training_set)

Deviance Residuals: 
   Min      1Q  Median      3Q     Max  
-1.536  -1.264   1.021   1.091   1.368  

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)   
(Intercept)  0.20326    0.06428   3.162  0.00157 **
Lag2         0.05810    0.02870   2.024  0.04298 * 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1354.7  on 984  degrees of freedom
Residual deviance: 1350.5  on 983  degrees of freedom
AIC: 1354.5

Number of Fisher Scoring iterations: 4</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Probabilidades predichas</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>yprob3 <span class="ot">&lt;-</span> <span class="fu">predict</span>(</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  modelo_logistic3, <span class="at">newdata =</span> validation_set, <span class="at">type =</span> <span class="st">'response'</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(yprob3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      986       987       988       989       990       991 
0.5261291 0.6447364 0.4862159 0.4852001 0.5197667 0.5401255 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Valores predichos</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>ypred3 <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(yprob3 <span class="sc">&gt;=</span> <span class="fl">0.5</span>) <span class="sc">|&gt;</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">factor</span>(<span class="at">labels =</span> <span class="fu">levels</span>(validation_set<span class="sc">$</span>Direction))</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ypred3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] Up   Up   Down Down Up   Up  
Levels: Down Up</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Matriz de confusión</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>tmp3 <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">confusionMatrix</span>(</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> ypred3, <span class="at">reference =</span> validation_set<span class="sc">$</span>Direction, </span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">positive =</span> <span class="st">"Up"</span>, <span class="at">mode =</span> <span class="st">"everything"</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>          Reference
Prediction Up Down
      Up   56   34
      Down  5    9</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>metricas_modelos <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  metricas_modelos,</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="fu">as.list</span>(<span class="fu">c</span>(tmp3[[<span class="dv">3</span>]], tmp3[[<span class="dv">4</span>]])), <span class="at">row.names =</span> <span class="st">"Modelo 3"</span>)</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">t</span>(metricas_modelos))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">Modelo 1</th>
<th style="text-align: right;">Modelo 2</th>
<th style="text-align: right;">Modelo 3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Accuracy</td>
<td style="text-align: right;">0.5610652</td>
<td style="text-align: right;">0.5619835</td>
<td style="text-align: right;">0.6250000</td>
</tr>
<tr class="even">
<td style="text-align: left;">Kappa</td>
<td style="text-align: right;">0.0349933</td>
<td style="text-align: right;">0.0986773</td>
<td style="text-align: right;">0.1414056</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AccuracyLower</td>
<td style="text-align: right;">0.5310002</td>
<td style="text-align: right;">0.5319228</td>
<td style="text-align: right;">0.5246597</td>
</tr>
<tr class="even">
<td style="text-align: left;">AccuracyUpper</td>
<td style="text-align: right;">0.5907994</td>
<td style="text-align: right;">0.5917084</td>
<td style="text-align: right;">0.7180252</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AccuracyNull</td>
<td style="text-align: right;">0.5555556</td>
<td style="text-align: right;">0.5555556</td>
<td style="text-align: right;">0.5865385</td>
</tr>
<tr class="even">
<td style="text-align: left;">AccuracyPValue</td>
<td style="text-align: right;">0.3690448</td>
<td style="text-align: right;">0.3462681</td>
<td style="text-align: right;">0.2439500</td>
</tr>
<tr class="odd">
<td style="text-align: left;">McnemarPValue</td>
<td style="text-align: right;">0.0000000</td>
<td style="text-align: right;">0.0005018</td>
<td style="text-align: right;">0.0000073</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sensitivity</td>
<td style="text-align: right;">0.9206612</td>
<td style="text-align: right;">0.6694215</td>
<td style="text-align: right;">0.9180328</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Specificity</td>
<td style="text-align: right;">0.1115702</td>
<td style="text-align: right;">0.4276860</td>
<td style="text-align: right;">0.2093023</td>
</tr>
<tr class="even">
<td style="text-align: left;">Pos.Pred.Value</td>
<td style="text-align: right;">0.5643364</td>
<td style="text-align: right;">0.5938416</td>
<td style="text-align: right;">0.6222222</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Neg.Pred.Value</td>
<td style="text-align: right;">0.5294118</td>
<td style="text-align: right;">0.5085995</td>
<td style="text-align: right;">0.6428571</td>
</tr>
<tr class="even">
<td style="text-align: left;">Precision</td>
<td style="text-align: right;">0.5643364</td>
<td style="text-align: right;">0.5938416</td>
<td style="text-align: right;">0.6222222</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Recall</td>
<td style="text-align: right;">0.9206612</td>
<td style="text-align: right;">0.6694215</td>
<td style="text-align: right;">0.9180328</td>
</tr>
<tr class="even">
<td style="text-align: left;">F1</td>
<td style="text-align: right;">0.6997487</td>
<td style="text-align: right;">0.6293706</td>
<td style="text-align: right;">0.7417219</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Prevalence</td>
<td style="text-align: right;">0.5555556</td>
<td style="text-align: right;">0.5555556</td>
<td style="text-align: right;">0.5865385</td>
</tr>
<tr class="even">
<td style="text-align: left;">Detection.Rate</td>
<td style="text-align: right;">0.5114784</td>
<td style="text-align: right;">0.3719008</td>
<td style="text-align: right;">0.5384615</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Detection.Prevalence</td>
<td style="text-align: right;">0.9063361</td>
<td style="text-align: right;">0.6262626</td>
<td style="text-align: right;">0.8653846</td>
</tr>
<tr class="even">
<td style="text-align: left;">Balanced.Accuracy</td>
<td style="text-align: right;">0.5161157</td>
<td style="text-align: right;">0.5485537</td>
<td style="text-align: right;">0.5636676</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><strong>Conclusiones</strong>:</p>
<ul>
<li>El nuevo modelo tiene <strong>mayor accuracy</strong> que los modelos previos, con un valor de <span class="math inline">\(62.5\%\)</span> .</li>
<li>El nuevo modelo presenta <strong>mayor coeficiente de Kappa</strong> que los modelos previos, aunque aún tan cercano a cero que no hay concordancia entre clases observadas y las pronosticadas.</li>
<li>El nuevo modelo es mejor que el segundo modelo en predecir una clase que positiva/exitosa (“Up”) para observaciones positivas/exitosas; aunque no tan bueno como el primer modelo, pues presenta <strong>menor sensibilidad</strong>.</li>
<li>En base a los valores de especificidad, el nuevo modelo es mejor que el primer modelo, aunque no tanto como el segundo modelo, en predecir una clase negativa (“Down”) para observaciones no exitosas (“Down” como valor de <code>Direction</code>).</li>
<li>En comparación a los dos primeros modelos, el nuevo modelo estima mayores probabilidades de que una nueva observación sea positiva/exitosa (PPV), y de que una nueva observación sea negativa (NPV).</li>
</ul>
</section>
<section id="pregunta-f" class="level3">
<h3 class="anchored" data-anchor-id="pregunta-f">Pregunta f</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::: #</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Regresión binaria con enlace probit #</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::::::::::::::: #</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>modelo_4_probit <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>  Direction <span class="sc">~</span> Lag2, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"probit"</span>), <span class="at">data =</span> training_set</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modelo_4_probit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = Direction ~ Lag2, family = binomial(link = "probit"), 
    data = training_set)

Deviance Residuals: 
   Min      1Q  Median      3Q     Max  
-1.540  -1.264   1.020   1.091   1.369  

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)   
(Intercept)  0.12728    0.04016   3.169  0.00153 **
Lag2         0.03640    0.01783   2.042  0.04120 * 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1354.7  on 984  degrees of freedom
Residual deviance: 1350.5  on 983  degrees of freedom
AIC: 1354.5

Number of Fisher Scoring iterations: 3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Probabilidades predichas</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>yprob4 <span class="ot">&lt;-</span> <span class="fu">predict</span>(</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  modelo_4_probit, <span class="at">newdata =</span> validation_set, <span class="at">type =</span> <span class="st">'response'</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Valores predichos</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>ypred4 <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(yprob4 <span class="sc">&gt;=</span> <span class="fl">0.5</span>) <span class="sc">|&gt;</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">factor</span>(<span class="at">labels =</span> <span class="fu">levels</span>(validation_set<span class="sc">$</span>Direction))</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Matriz de confusión</span></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>tmp4 <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">confusionMatrix</span>(</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> ypred4, <span class="at">reference =</span> validation_set<span class="sc">$</span>Direction, </span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">positive =</span> <span class="st">"Up"</span>, <span class="at">mode =</span> <span class="st">"everything"</span></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>metricas_modelos <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>  metricas_modelos,</span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="fu">as.list</span>(<span class="fu">c</span>(tmp4[[<span class="dv">3</span>]], tmp4[[<span class="dv">4</span>]])), <span class="at">row.names =</span> <span class="st">"Modelo 4: probit"</span>)</span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>          Reference
Prediction Up Down
      Up   56   34
      Down  5    9</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::: #</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Regresión binaria con enlace cloglog #</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::: #</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>modelo_5_cloglog <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>  Direction <span class="sc">~</span> Lag2, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"cloglog"</span>), <span class="at">data =</span> training_set</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modelo_5_cloglog)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = Direction ~ Lag2, family = binomial(link = "cloglog"), 
    data = training_set)

Deviance Residuals: 
   Min      1Q  Median      3Q     Max  
-1.575  -1.262   1.017   1.091   1.363  

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -0.22485    0.04433  -5.072 3.94e-07 ***
Lag2         0.04197    0.01983   2.116   0.0343 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1354.7  on 984  degrees of freedom
Residual deviance: 1350.4  on 983  degrees of freedom
AIC: 1354.4

Number of Fisher Scoring iterations: 5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Probabilidades predichas</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>yprob5 <span class="ot">&lt;-</span> <span class="fu">predict</span>(</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  modelo_5_cloglog, <span class="at">newdata =</span> validation_set, <span class="at">type =</span> <span class="st">'response'</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Valores predichos</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>ypred5 <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(yprob5 <span class="sc">&gt;=</span> <span class="fl">0.5</span>) <span class="sc">|&gt;</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">factor</span>(<span class="at">labels =</span> <span class="fu">levels</span>(validation_set<span class="sc">$</span>Direction))</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Matriz de confusión</span></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>tmp5 <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">confusionMatrix</span>(</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> ypred5, <span class="at">reference =</span> validation_set<span class="sc">$</span>Direction, </span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">positive =</span> <span class="st">"Up"</span>, <span class="at">mode =</span> <span class="st">"everything"</span></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>metricas_modelos <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>  metricas_modelos,</span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="fu">as.list</span>(<span class="fu">c</span>(tmp5[[<span class="dv">3</span>]], tmp5[[<span class="dv">4</span>]])), <span class="at">row.names =</span> <span class="st">"Modelo 5: cloglog"</span>)</span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>          Reference
Prediction Up Down
      Up   56   34
      Down  5    9</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::: #</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Regresión binaria con enlace cauchit #</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::: #</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>modelo_6_cauchit <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>  Direction <span class="sc">~</span> Lag2, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"cauchit"</span>), <span class="at">data =</span> training_set</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modelo_6_cauchit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = Direction ~ Lag2, family = binomial(link = "cauchit"), 
    data = training_set)

Deviance Residuals: 
   Min      1Q  Median      3Q     Max  
-1.512  -1.264   1.023   1.091   1.364  

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)   
(Intercept)  0.16041    0.05151   3.114  0.00185 **
Lag2         0.04573    0.02370   1.929  0.05369 . 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1354.7  on 984  degrees of freedom
Residual deviance: 1350.7  on 983  degrees of freedom
AIC: 1354.7

Number of Fisher Scoring iterations: 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Probabilidades predichas</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>yprob6 <span class="ot">&lt;-</span> <span class="fu">predict</span>(</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  modelo_6_cauchit, <span class="at">newdata =</span> validation_set, <span class="at">type =</span> <span class="st">'response'</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Valores predichos</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>ypred6 <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(yprob6 <span class="sc">&gt;=</span> <span class="fl">0.5</span>) <span class="sc">|&gt;</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">factor</span>(<span class="at">labels =</span> <span class="fu">levels</span>(validation_set<span class="sc">$</span>Direction))</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Matriz de confusión</span></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>tmp6 <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">confusionMatrix</span>(</span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> ypred6, <span class="at">reference =</span> validation_set<span class="sc">$</span>Direction, </span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">positive =</span> <span class="st">"Up"</span>, <span class="at">mode =</span> <span class="st">"everything"</span></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>metricas_modelos <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>  metricas_modelos,</span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="fu">as.list</span>(<span class="fu">c</span>(tmp6[[<span class="dv">3</span>]], tmp6[[<span class="dv">4</span>]])), <span class="at">row.names =</span> <span class="st">"Modelo 6: cauchit"</span>)</span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>          Reference
Prediction Up Down
      Up   56   34
      Down  5    9</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::: #</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Modelo Naive Bayes con estimación no </span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="co"># paramétrica de la densidad del predictor Lag2</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="co">#::::::::::::::::::::::::::::::::::::::::::::: #</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(naivebayes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'naivebayes' was built under R version 4.1.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>naivebayes 0.9.7 loaded</code></pre>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>modelo_7_naive_bayes <span class="ot">&lt;-</span> <span class="fu">naive_bayes</span>(</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> training_set[<span class="st">"Lag2"</span>], <span class="at">y =</span> training_set<span class="sc">$</span>Direction, </span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">usekernel =</span> <span class="cn">TRUE</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Probabilidades predichas</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>yprob7 <span class="ot">&lt;-</span> <span class="fu">predict</span>(modelo_7_naive_bayes, <span class="at">newdata =</span> validation_set[<span class="st">"Lag2"</span>], <span class="at">type =</span> <span class="st">'prob'</span>)[,<span class="dv">2</span>]</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Valores predichos</span></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>ypred7 <span class="ot">&lt;-</span> <span class="fu">predict</span>(modelo_7_naive_bayes, <span class="at">newdata =</span> validation_set[<span class="st">"Lag2"</span>])</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Matriz de confusión</span></span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>tmp7 <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">confusionMatrix</span>(</span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> ypred7, <span class="at">reference =</span> validation_set<span class="sc">$</span>Direction, </span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">positive =</span> <span class="st">"Up"</span>, <span class="at">mode =</span> <span class="st">"everything"</span></span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a>metricas_modelos <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a>  metricas_modelos,</span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="fu">as.list</span>(<span class="fu">c</span>(tmp7[[<span class="dv">3</span>]], tmp7[[<span class="dv">4</span>]])), <span class="at">row.names =</span> <span class="st">"Modelo 7: Naive Bayes"</span>)</span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>          Reference
Prediction Up Down
      Up   56   36
      Down  5    7</code></pre>
</div>
</div>
<p>Respecto al uso del modelo <strong>KNN</strong>, no es necesario estandarizar las variables, ya que solo se tiene un predictor, <code>Lag2</code>, el cual es numérico, por lo que tampoco se tienen predictores categóricos por binarizar.</p>
<p>Asimismo, usaremos todos los datos de <code>Weekly</code> para validación cruzada, en vez de dividir el conjunto de entrenamiento fijado previamente en uno o más pares (nuevo conjunto de entrenamiento, nuevo conjunto de validación). Esto debido a que, con más datos, los modelos se entrenan mejor.</p>
<p>Por último, emplearemos LOOCV y estaremos usando la tasa de error de clasificación, como criterio de selección de los modelos KNN, para distintos valores de K.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Consideramos el tamaño de la vecindad K entre 1 y 100</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>numero_casos_K <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>error_rate <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, numero_casos_K)</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Fijamos semilla debido al posible caso de "tie-breaks"</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a><span class="co"># cuando se vota por la clase por predecir.</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">6174</span>)</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (K <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>numero_casos_K) {</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>  error_rate[K] <span class="ot">&lt;-</span> <span class="fu">mean</span>(</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>    class<span class="sc">::</span><span class="fu">knn.cv</span>(<span class="at">train =</span> Weekly[<span class="st">"Lag2"</span>], <span class="at">cl =</span> Weekly<span class="sc">$</span>Direction, <span class="at">k =</span> K) <span class="sc">!=</span> Weekly<span class="sc">$</span>Direction</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a>  error_rate, <span class="at">main =</span> <span class="st">"LOOCV"</span>, <span class="at">type =</span> <span class="st">'l'</span>,</span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">"Tamaño de vecindad (K)"</span>, <span class="at">ylab =</span> <span class="st">"Tasa de error de clasificación"</span></span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tamaño de vecindad que minimiza la tasa de error de clasificación</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>optimum_K <span class="ot">&lt;-</span> <span class="fu">which.min</span>(error_rate)</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>optimum_K</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 33</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::: #</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Modelo KNN usando K = 33 </span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="co">#:::::::::::::::::::::::: #</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Valores predichos</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>ypred8 <span class="ot">&lt;-</span> class<span class="sc">::</span><span class="fu">knn</span>(</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">train =</span> training_set[<span class="st">"Lag2"</span>], <span class="at">test =</span> validation_set[<span class="st">"Lag2"</span>],</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">cl =</span> training_set<span class="sc">$</span>Direction, <span class="at">k =</span> optimum_K, <span class="at">prob =</span> <span class="cn">TRUE</span></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimaciones de probabilidades predichas</span></span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>yprob8 <span class="ot">&lt;-</span> <span class="fu">attr</span>(ypred8, <span class="st">"prob"</span>)</span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Matriz de confusión</span></span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>tmp8 <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">confusionMatrix</span>(</span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> ypred8, <span class="at">reference =</span> validation_set<span class="sc">$</span>Direction, </span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">positive =</span> <span class="st">"Up"</span>, <span class="at">mode =</span> <span class="st">"everything"</span></span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-19"><a href="#cb75-19" aria-hidden="true" tabindex="-1"></a>metricas_modelos <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb75-20"><a href="#cb75-20" aria-hidden="true" tabindex="-1"></a>  metricas_modelos,</span>
<span id="cb75-21"><a href="#cb75-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="fu">as.list</span>(<span class="fu">c</span>(tmp8[[<span class="dv">3</span>]], tmp8[[<span class="dv">4</span>]])), <span class="at">row.names =</span> <span class="st">"Modelo 8: KNN"</span>)</span>
<span id="cb75-22"><a href="#cb75-22" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>          Reference
Prediction Up Down
      Up   36   22
      Down 25   21</code></pre>
</div>
</div>
<p><strong>Comparación de los modelos a partir de la pregunta anterior</strong>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">t</span>(metricas_modelos[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>),]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 17%">
<col style="width: 8%">
<col style="width: 14%">
<col style="width: 15%">
<col style="width: 15%">
<col style="width: 18%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">Modelo 3</th>
<th style="text-align: right;">Modelo 4: probit</th>
<th style="text-align: right;">Modelo 5: cloglog</th>
<th style="text-align: right;">Modelo 6: cauchit</th>
<th style="text-align: right;">Modelo 7: Naive Bayes</th>
<th style="text-align: right;">Modelo 8: KNN</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Accuracy</td>
<td style="text-align: right;">0.6250000</td>
<td style="text-align: right;">0.6250000</td>
<td style="text-align: right;">0.6250000</td>
<td style="text-align: right;">0.6250000</td>
<td style="text-align: right;">0.6057692</td>
<td style="text-align: right;">0.5480769</td>
</tr>
<tr class="even">
<td style="text-align: left;">Kappa</td>
<td style="text-align: right;">0.1414056</td>
<td style="text-align: right;">0.1414056</td>
<td style="text-align: right;">0.1414056</td>
<td style="text-align: right;">0.1414056</td>
<td style="text-align: right;">0.0904437</td>
<td style="text-align: right;">0.0777358</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AccuracyLower</td>
<td style="text-align: right;">0.5246597</td>
<td style="text-align: right;">0.5246597</td>
<td style="text-align: right;">0.5246597</td>
<td style="text-align: right;">0.5246597</td>
<td style="text-align: right;">0.5051377</td>
<td style="text-align: right;">0.4474460</td>
</tr>
<tr class="even">
<td style="text-align: left;">AccuracyUpper</td>
<td style="text-align: right;">0.7180252</td>
<td style="text-align: right;">0.7180252</td>
<td style="text-align: right;">0.7180252</td>
<td style="text-align: right;">0.7180252</td>
<td style="text-align: right;">0.7002144</td>
<td style="text-align: right;">0.6458988</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AccuracyNull</td>
<td style="text-align: right;">0.5865385</td>
<td style="text-align: right;">0.5865385</td>
<td style="text-align: right;">0.5865385</td>
<td style="text-align: right;">0.5865385</td>
<td style="text-align: right;">0.5865385</td>
<td style="text-align: right;">0.5865385</td>
</tr>
<tr class="even">
<td style="text-align: left;">AccuracyPValue</td>
<td style="text-align: right;">0.2439500</td>
<td style="text-align: right;">0.2439500</td>
<td style="text-align: right;">0.2439500</td>
<td style="text-align: right;">0.2439500</td>
<td style="text-align: right;">0.3846868</td>
<td style="text-align: right;">0.8151603</td>
</tr>
<tr class="odd">
<td style="text-align: left;">McnemarPValue</td>
<td style="text-align: right;">0.0000073</td>
<td style="text-align: right;">0.0000073</td>
<td style="text-align: right;">0.0000073</td>
<td style="text-align: right;">0.0000073</td>
<td style="text-align: right;">0.0000028</td>
<td style="text-align: right;">0.7704931</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sensitivity</td>
<td style="text-align: right;">0.9180328</td>
<td style="text-align: right;">0.9180328</td>
<td style="text-align: right;">0.9180328</td>
<td style="text-align: right;">0.9180328</td>
<td style="text-align: right;">0.9180328</td>
<td style="text-align: right;">0.5901639</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Specificity</td>
<td style="text-align: right;">0.2093023</td>
<td style="text-align: right;">0.2093023</td>
<td style="text-align: right;">0.2093023</td>
<td style="text-align: right;">0.2093023</td>
<td style="text-align: right;">0.1627907</td>
<td style="text-align: right;">0.4883721</td>
</tr>
<tr class="even">
<td style="text-align: left;">Pos.Pred.Value</td>
<td style="text-align: right;">0.6222222</td>
<td style="text-align: right;">0.6222222</td>
<td style="text-align: right;">0.6222222</td>
<td style="text-align: right;">0.6222222</td>
<td style="text-align: right;">0.6086957</td>
<td style="text-align: right;">0.6206897</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Neg.Pred.Value</td>
<td style="text-align: right;">0.6428571</td>
<td style="text-align: right;">0.6428571</td>
<td style="text-align: right;">0.6428571</td>
<td style="text-align: right;">0.6428571</td>
<td style="text-align: right;">0.5833333</td>
<td style="text-align: right;">0.4565217</td>
</tr>
<tr class="even">
<td style="text-align: left;">Precision</td>
<td style="text-align: right;">0.6222222</td>
<td style="text-align: right;">0.6222222</td>
<td style="text-align: right;">0.6222222</td>
<td style="text-align: right;">0.6222222</td>
<td style="text-align: right;">0.6086957</td>
<td style="text-align: right;">0.6206897</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Recall</td>
<td style="text-align: right;">0.9180328</td>
<td style="text-align: right;">0.9180328</td>
<td style="text-align: right;">0.9180328</td>
<td style="text-align: right;">0.9180328</td>
<td style="text-align: right;">0.9180328</td>
<td style="text-align: right;">0.5901639</td>
</tr>
<tr class="even">
<td style="text-align: left;">F1</td>
<td style="text-align: right;">0.7417219</td>
<td style="text-align: right;">0.7417219</td>
<td style="text-align: right;">0.7417219</td>
<td style="text-align: right;">0.7417219</td>
<td style="text-align: right;">0.7320261</td>
<td style="text-align: right;">0.6050420</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Prevalence</td>
<td style="text-align: right;">0.5865385</td>
<td style="text-align: right;">0.5865385</td>
<td style="text-align: right;">0.5865385</td>
<td style="text-align: right;">0.5865385</td>
<td style="text-align: right;">0.5865385</td>
<td style="text-align: right;">0.5865385</td>
</tr>
<tr class="even">
<td style="text-align: left;">Detection.Rate</td>
<td style="text-align: right;">0.5384615</td>
<td style="text-align: right;">0.5384615</td>
<td style="text-align: right;">0.5384615</td>
<td style="text-align: right;">0.5384615</td>
<td style="text-align: right;">0.5384615</td>
<td style="text-align: right;">0.3461538</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Detection.Prevalence</td>
<td style="text-align: right;">0.8653846</td>
<td style="text-align: right;">0.8653846</td>
<td style="text-align: right;">0.8653846</td>
<td style="text-align: right;">0.8653846</td>
<td style="text-align: right;">0.8846154</td>
<td style="text-align: right;">0.5576923</td>
</tr>
<tr class="even">
<td style="text-align: left;">Balanced.Accuracy</td>
<td style="text-align: right;">0.5636676</td>
<td style="text-align: right;">0.5636676</td>
<td style="text-align: right;">0.5636676</td>
<td style="text-align: right;">0.5636676</td>
<td style="text-align: right;">0.5404117</td>
<td style="text-align: right;">0.5392680</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li>Notamos que los cuatro modelos de tipo <code>glm()</code> presentan las mismas métricas respecto al conjunto de validación (accuracy, sensibilidad, etc).</li>
<li>Los mayores valores de <strong>accuracy</strong> y <strong>coeficiente de Kappa</strong> entre los modelos presentados ocurren para el modelo de regresión logística.</li>
<li>El modelo <strong>Naive Bayes</strong> presenta la <strong>máxima sensibilidad</strong> y <strong>mínima especificidad</strong>.</li>
<li>Por último, resaltamos que el modelo <strong>Naive Bayes</strong> no siempre presenta métricas con mayor valor que en el modelo <strong>KNN</strong>. Por ejemplo, <strong>KNN</strong> presenta mayor especificidad que <strong>Naive Bayes</strong>; mas, tiene menor coeficiente de Kappa.</li>
</ul>
</section>
<section id="pregunta-g" class="level3">
<h3 class="anchored" data-anchor-id="pregunta-g">Pregunta g</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Curvas ROC</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>curvas_roc <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>curvas_roc[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">roc</span>(<span class="at">response =</span> validation_set<span class="sc">$</span>Direction, <span class="at">predictor =</span> yprob3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &gt; cases</code></pre>
</div>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>curvas_roc[[<span class="dv">2</span>]] <span class="ot">&lt;-</span> <span class="fu">roc</span>(<span class="at">response =</span> validation_set<span class="sc">$</span>Direction, <span class="at">predictor =</span> yprob4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up
Setting direction: controls &gt; cases</code></pre>
</div>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>curvas_roc[[<span class="dv">3</span>]] <span class="ot">&lt;-</span> <span class="fu">roc</span>(<span class="at">response =</span> validation_set<span class="sc">$</span>Direction, <span class="at">predictor =</span> yprob5)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up
Setting direction: controls &gt; cases</code></pre>
</div>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>curvas_roc[[<span class="dv">4</span>]] <span class="ot">&lt;-</span> <span class="fu">roc</span>(<span class="at">response =</span> validation_set<span class="sc">$</span>Direction, <span class="at">predictor =</span> yprob6)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up
Setting direction: controls &gt; cases</code></pre>
</div>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>curvas_roc[[<span class="dv">5</span>]] <span class="ot">&lt;-</span> <span class="fu">roc</span>(<span class="at">response =</span> validation_set<span class="sc">$</span>Direction, <span class="at">predictor =</span> yprob7)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>curvas_roc[[<span class="dv">6</span>]] <span class="ot">&lt;-</span> <span class="fu">roc</span>(<span class="at">response =</span> validation_set<span class="sc">$</span>Direction, <span class="at">predictor =</span> yprob8)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up
Setting direction: controls &lt; cases</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Curva ROC</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span> <span class="sc">-</span> curvas_roc[[<span class="dv">1</span>]]<span class="sc">$</span>specificities, curvas_roc[[<span class="dv">1</span>]]<span class="sc">$</span>sensitivities,</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">"Sensitividad"</span>, <span class="at">xlab =</span> <span class="st">"1 - Especificidad"</span>,</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">"Curvas ROC para los modelos 3, 4, 5, 6, 7 y 8"</span>,</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">col =</span> <span class="dv">1</span>, <span class="at">lwd =</span> <span class="dv">2</span></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (indice <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>) {</span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(<span class="dv">1</span> <span class="sc">-</span> curvas_roc[[indice]]<span class="sc">$</span>specificities, curvas_roc[[indice]]<span class="sc">$</span>sensitivities, <span class="at">col =</span> indice)</span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a =</span> <span class="dv">0</span>, <span class="at">b =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">legend =</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">8</span>, <span class="at">fill =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>De la gráfica notamos que ninguno de los modelos es cercano al modelo ideal, pues las curvas ROC no están cercanas al punto <span class="math inline">\(\left( 0, 1 \right)\)</span> del gráfico.</p>
<p>Asimismo, los modelos asociados al gráfico presentan curvas ROC relativamente cerca a la recta (diagonal) <span class="math inline">\(x = y\)</span> . Esto significa que las predicciones generadas por estos modelos no difieren mucho de si se predijese al azar la clase. Esto se evidencia por los valores tan cercanos a cero de los coeficientes de Kappa de estos modelos.</p>
<p>También notamos que la curva ROC asociada al modelo KNN (color morado) es <em>muy poligonal</em> (no parece tan <em>continua</em> como las otras curvas). Esto es consecuencia de que las estimaciones de probabilidad de pertencia a una clase son mucho menos precisas para KNN, comparado a los otros modelos. Aquello debido a que tal probabilidad se estima según las proporciones de las clases respecto a los elementos de la vecindad; así, para cada vecindad considerada de <strong>K</strong> observaciones.</p>
<p>Por último, inspeccionando una <em>distancia promedio</em> entre cada curva ROC y el punto <span class="math inline">\(\left( 0, 1 \right)\)</span>, notamos que el modelo <strong>Naive Bayes</strong> (color celeste) podría considerarse el mejor entre los modelos testeados (curva ROC más cercana a <span class="math inline">\(\left( 0,1 \right)\)</span>).</p>
</section>
<section id="pregunta-h" class="level3">
<h3 class="anchored" data-anchor-id="pregunta-h">Pregunta h</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Particionamos Weekly en 10 partes de </span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="co"># aproximadamente la misma cantidad de observaciones</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Número de folds</span></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1729</span>)</span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>splitPlan <span class="ot">&lt;-</span> vtreat<span class="sc">::</span><span class="fu">kWayCrossValidation</span>(<span class="at">nRows =</span> <span class="fu">nrow</span>(Weekly), k)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Para considerar distintos puntos de corte, fijaremos la métrica área bajo la curva ROC (<strong>AUC</strong>) como criterio de comparación de modelos.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>resultados_finales <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Modelo =</span> <span class="fu">c</span>(</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Binomial, Link logit"</span>, <span class="st">"Binomial, Link probit"</span>,</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Binomial, Link cloglog"</span>, <span class="st">"Binomial, Link cauchit"</span>,</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Naive Bayes"</span>, <span class="st">"KNN, K = 33"</span></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Para cada uno de los 10 folds, guardamos el valor hallado de AUC</span></span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (fold <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>k) {</span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a>  resultados_finales[<span class="fu">paste0</span>(<span class="st">"AUC_"</span>, fold)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a>resultados_finales</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  Modelo AUC_1 AUC_2 AUC_3 AUC_4 AUC_5 AUC_6 AUC_7 AUC_8 AUC_9
1   Binomial, Link logit     0     0     0     0     0     0     0     0     0
2  Binomial, Link probit     0     0     0     0     0     0     0     0     0
3 Binomial, Link cloglog     0     0     0     0     0     0     0     0     0
4 Binomial, Link cauchit     0     0     0     0     0     0     0     0     0
5            Naive Bayes     0     0     0     0     0     0     0     0     0
6            KNN, K = 33     0     0     0     0     0     0     0     0     0
  AUC_10
1      0
2      0
3      0
4      0
5      0
6      0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(fold <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>k) {</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>  split <span class="ot">&lt;-</span> splitPlan[[fold]]</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Hallamos las probabilidades predichas para el </span></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># conjunto de validación, para cada uno de los seis modelos .</span></span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (fila <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>) {</span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>    modelo <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>    prob_pred <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Modelo glm(..., binomial("logit"))</span></span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (fila <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a>      modelo <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a>        Direction <span class="sc">~</span> Lag2, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>), </span>
<span id="cb96-14"><a href="#cb96-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> Weekly[split<span class="sc">$</span>train,]</span>
<span id="cb96-15"><a href="#cb96-15" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb96-16"><a href="#cb96-16" aria-hidden="true" tabindex="-1"></a>      prob_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(</span>
<span id="cb96-17"><a href="#cb96-17" aria-hidden="true" tabindex="-1"></a>        modelo, <span class="at">newdata =</span> Weekly[split<span class="sc">$</span>app,], <span class="at">type =</span> <span class="st">'response'</span></span>
<span id="cb96-18"><a href="#cb96-18" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb96-19"><a href="#cb96-19" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb96-20"><a href="#cb96-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-21"><a href="#cb96-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Modelo glm(..., binomial("probit"))</span></span>
<span id="cb96-22"><a href="#cb96-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (fila <span class="sc">==</span> <span class="dv">2</span>) {</span>
<span id="cb96-23"><a href="#cb96-23" aria-hidden="true" tabindex="-1"></a>      modelo <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb96-24"><a href="#cb96-24" aria-hidden="true" tabindex="-1"></a>        Direction <span class="sc">~</span> Lag2, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"probit"</span>), </span>
<span id="cb96-25"><a href="#cb96-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> Weekly[split<span class="sc">$</span>train,]</span>
<span id="cb96-26"><a href="#cb96-26" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb96-27"><a href="#cb96-27" aria-hidden="true" tabindex="-1"></a>      prob_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(</span>
<span id="cb96-28"><a href="#cb96-28" aria-hidden="true" tabindex="-1"></a>        modelo, <span class="at">newdata =</span> Weekly[split<span class="sc">$</span>app,], <span class="at">type =</span> <span class="st">'response'</span></span>
<span id="cb96-29"><a href="#cb96-29" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb96-30"><a href="#cb96-30" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb96-31"><a href="#cb96-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-32"><a href="#cb96-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Modelo glm(..., binomial("cloglog"))</span></span>
<span id="cb96-33"><a href="#cb96-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (fila <span class="sc">==</span> <span class="dv">3</span>) {</span>
<span id="cb96-34"><a href="#cb96-34" aria-hidden="true" tabindex="-1"></a>      modelo <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb96-35"><a href="#cb96-35" aria-hidden="true" tabindex="-1"></a>        Direction <span class="sc">~</span> Lag2, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"cloglog"</span>), </span>
<span id="cb96-36"><a href="#cb96-36" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> Weekly[split<span class="sc">$</span>train,]</span>
<span id="cb96-37"><a href="#cb96-37" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb96-38"><a href="#cb96-38" aria-hidden="true" tabindex="-1"></a>      prob_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(</span>
<span id="cb96-39"><a href="#cb96-39" aria-hidden="true" tabindex="-1"></a>        modelo, <span class="at">newdata =</span> Weekly[split<span class="sc">$</span>app,], <span class="at">type =</span> <span class="st">'response'</span></span>
<span id="cb96-40"><a href="#cb96-40" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb96-41"><a href="#cb96-41" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb96-42"><a href="#cb96-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-43"><a href="#cb96-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Modelo glm(..., binomial("cauchit"))</span></span>
<span id="cb96-44"><a href="#cb96-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (fila <span class="sc">==</span> <span class="dv">4</span>) {</span>
<span id="cb96-45"><a href="#cb96-45" aria-hidden="true" tabindex="-1"></a>      modelo <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb96-46"><a href="#cb96-46" aria-hidden="true" tabindex="-1"></a>        Direction <span class="sc">~</span> Lag2, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"cauchit"</span>), </span>
<span id="cb96-47"><a href="#cb96-47" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> Weekly[split<span class="sc">$</span>train,]</span>
<span id="cb96-48"><a href="#cb96-48" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb96-49"><a href="#cb96-49" aria-hidden="true" tabindex="-1"></a>      prob_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(</span>
<span id="cb96-50"><a href="#cb96-50" aria-hidden="true" tabindex="-1"></a>        modelo, <span class="at">newdata =</span> Weekly[split<span class="sc">$</span>app,], <span class="at">type =</span> <span class="st">'response'</span></span>
<span id="cb96-51"><a href="#cb96-51" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb96-52"><a href="#cb96-52" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb96-53"><a href="#cb96-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-54"><a href="#cb96-54" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Modelo Naive Bayes</span></span>
<span id="cb96-55"><a href="#cb96-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (fila <span class="sc">==</span> <span class="dv">5</span>) {</span>
<span id="cb96-56"><a href="#cb96-56" aria-hidden="true" tabindex="-1"></a>      modelo <span class="ot">&lt;-</span> <span class="fu">naive_bayes</span>(</span>
<span id="cb96-57"><a href="#cb96-57" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> Weekly[split<span class="sc">$</span>train,][<span class="st">"Lag2"</span>], <span class="at">y =</span> Weekly[split<span class="sc">$</span>train,]<span class="sc">$</span>Direction, </span>
<span id="cb96-58"><a href="#cb96-58" aria-hidden="true" tabindex="-1"></a>        <span class="at">usekernel =</span> <span class="cn">TRUE</span></span>
<span id="cb96-59"><a href="#cb96-59" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb96-60"><a href="#cb96-60" aria-hidden="true" tabindex="-1"></a>      prob_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(</span>
<span id="cb96-61"><a href="#cb96-61" aria-hidden="true" tabindex="-1"></a>        modelo, <span class="at">newdata =</span> Weekly[split<span class="sc">$</span>app,][<span class="st">"Lag2"</span>],  <span class="at">type =</span> <span class="st">'prob'</span></span>
<span id="cb96-62"><a href="#cb96-62" aria-hidden="true" tabindex="-1"></a>      )[,<span class="dv">2</span>]</span>
<span id="cb96-63"><a href="#cb96-63" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb96-64"><a href="#cb96-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-65"><a href="#cb96-65" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Modelo KNN con K = 33</span></span>
<span id="cb96-66"><a href="#cb96-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (fila <span class="sc">==</span> <span class="dv">6</span>) {</span>
<span id="cb96-67"><a href="#cb96-67" aria-hidden="true" tabindex="-1"></a>      modelo <span class="ot">&lt;-</span> class<span class="sc">::</span><span class="fu">knn</span>(</span>
<span id="cb96-68"><a href="#cb96-68" aria-hidden="true" tabindex="-1"></a>        <span class="at">train =</span> Weekly[split<span class="sc">$</span>train,][<span class="st">"Lag2"</span>], <span class="at">test =</span> Weekly[split<span class="sc">$</span>app,][<span class="st">"Lag2"</span>],</span>
<span id="cb96-69"><a href="#cb96-69" aria-hidden="true" tabindex="-1"></a>        <span class="at">cl =</span> Weekly[split<span class="sc">$</span>train,]<span class="sc">$</span>Direction, <span class="at">k =</span> optimum_K, <span class="at">prob =</span> <span class="cn">TRUE</span></span>
<span id="cb96-70"><a href="#cb96-70" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb96-71"><a href="#cb96-71" aria-hidden="true" tabindex="-1"></a>      prob_pred <span class="ot">&lt;-</span> <span class="fu">attr</span>(modelo, <span class="st">"prob"</span>)</span>
<span id="cb96-72"><a href="#cb96-72" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb96-73"><a href="#cb96-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-74"><a href="#cb96-74" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb96-75"><a href="#cb96-75" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Grabar el valor de AUC asociado al fold, para cada modelo .</span></span>
<span id="cb96-76"><a href="#cb96-76" aria-hidden="true" tabindex="-1"></a>    analysis <span class="ot">&lt;-</span> <span class="fu">roc</span>(</span>
<span id="cb96-77"><a href="#cb96-77" aria-hidden="true" tabindex="-1"></a>      <span class="at">response =</span> Weekly[split<span class="sc">$</span>app,]<span class="sc">$</span>Direction, <span class="at">predictor =</span> prob_pred</span>
<span id="cb96-78"><a href="#cb96-78" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb96-79"><a href="#cb96-79" aria-hidden="true" tabindex="-1"></a>    resultados_finales[fila, <span class="fu">paste0</span>(<span class="st">"AUC_"</span>, fold)] <span class="ot">&lt;-</span> analysis<span class="sc">$</span>auc</span>
<span id="cb96-80"><a href="#cb96-80" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb96-81"><a href="#cb96-81" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &gt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &gt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &gt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &gt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &gt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &gt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &gt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &gt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &gt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &gt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &gt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &gt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &gt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &gt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &gt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &gt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &gt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &gt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &gt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &gt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &gt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &gt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &gt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &gt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &gt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &gt; cases</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = Down, case = Up</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb217"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(resultados_finales)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 18%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Modelo</th>
<th style="text-align: right;">AUC_1</th>
<th style="text-align: right;">AUC_2</th>
<th style="text-align: right;">AUC_3</th>
<th style="text-align: right;">AUC_4</th>
<th style="text-align: right;">AUC_5</th>
<th style="text-align: right;">AUC_6</th>
<th style="text-align: right;">AUC_7</th>
<th style="text-align: right;">AUC_8</th>
<th style="text-align: right;">AUC_9</th>
<th style="text-align: right;">AUC_10</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Binomial, Link logit</td>
<td style="text-align: right;">0.6188187</td>
<td style="text-align: right;">0.5230508</td>
<td style="text-align: right;">0.4875622</td>
<td style="text-align: right;">0.5650309</td>
<td style="text-align: right;">0.6086066</td>
<td style="text-align: right;">0.5114478</td>
<td style="text-align: right;">0.5746377</td>
<td style="text-align: right;">0.5096844</td>
<td style="text-align: right;">0.5307377</td>
<td style="text-align: right;">0.4736308</td>
</tr>
<tr class="even">
<td style="text-align: left;">Binomial, Link probit</td>
<td style="text-align: right;">0.6188187</td>
<td style="text-align: right;">0.5230508</td>
<td style="text-align: right;">0.4875622</td>
<td style="text-align: right;">0.5650309</td>
<td style="text-align: right;">0.6086066</td>
<td style="text-align: right;">0.5114478</td>
<td style="text-align: right;">0.5746377</td>
<td style="text-align: right;">0.5096844</td>
<td style="text-align: right;">0.5307377</td>
<td style="text-align: right;">0.4736308</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Binomial, Link cloglog</td>
<td style="text-align: right;">0.6188187</td>
<td style="text-align: right;">0.5230508</td>
<td style="text-align: right;">0.4875622</td>
<td style="text-align: right;">0.5650309</td>
<td style="text-align: right;">0.6086066</td>
<td style="text-align: right;">0.5114478</td>
<td style="text-align: right;">0.5746377</td>
<td style="text-align: right;">0.5096844</td>
<td style="text-align: right;">0.5307377</td>
<td style="text-align: right;">0.4736308</td>
</tr>
<tr class="even">
<td style="text-align: left;">Binomial, Link cauchit</td>
<td style="text-align: right;">0.6188187</td>
<td style="text-align: right;">0.5230508</td>
<td style="text-align: right;">0.4875622</td>
<td style="text-align: right;">0.5650309</td>
<td style="text-align: right;">0.6086066</td>
<td style="text-align: right;">0.5114478</td>
<td style="text-align: right;">0.5746377</td>
<td style="text-align: right;">0.5096844</td>
<td style="text-align: right;">0.5307377</td>
<td style="text-align: right;">0.4736308</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Naive Bayes</td>
<td style="text-align: right;">0.4938187</td>
<td style="text-align: right;">0.5637288</td>
<td style="text-align: right;">0.5636105</td>
<td style="text-align: right;">0.5760124</td>
<td style="text-align: right;">0.5594262</td>
<td style="text-align: right;">0.5309764</td>
<td style="text-align: right;">0.6630435</td>
<td style="text-align: right;">0.5071736</td>
<td style="text-align: right;">0.5297131</td>
<td style="text-align: right;">0.5990534</td>
</tr>
<tr class="even">
<td style="text-align: left;">KNN, K = 33</td>
<td style="text-align: right;">0.5453297</td>
<td style="text-align: right;">0.5659322</td>
<td style="text-align: right;">0.5618337</td>
<td style="text-align: right;">0.5013727</td>
<td style="text-align: right;">0.5017077</td>
<td style="text-align: right;">0.5373737</td>
<td style="text-align: right;">0.5121377</td>
<td style="text-align: right;">0.5342539</td>
<td style="text-align: right;">0.5061475</td>
<td style="text-align: right;">0.5792765</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb218"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Promediamos de manera ponderada los diez valores de AUC,</span></span>
<span id="cb218-2"><a href="#cb218-2" aria-hidden="true" tabindex="-1"></a><span class="co"># respecto a la cantidad de observaciones en los 10 conjuntos de validación</span></span>
<span id="cb218-3"><a href="#cb218-3" aria-hidden="true" tabindex="-1"></a>resultados_finales[<span class="st">"AUC_ponderado"</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb218-4"><a href="#cb218-4" aria-hidden="true" tabindex="-1"></a>sum_sizes_validation_sets <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb218-5"><a href="#cb218-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-6"><a href="#cb218-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Suma ponderada</span></span>
<span id="cb218-7"><a href="#cb218-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (fila <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>) {</span>
<span id="cb218-8"><a href="#cb218-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (fold <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>k) {</span>
<span id="cb218-9"><a href="#cb218-9" aria-hidden="true" tabindex="-1"></a>    resultados_finales[fila, <span class="st">"AUC_ponderado"</span>] <span class="ot">&lt;-</span> resultados_finales[fila, <span class="st">"AUC_ponderado"</span>] <span class="sc">+</span> resultados_finales[fila, <span class="fu">paste0</span>(<span class="st">"AUC_"</span>, fold)] <span class="sc">*</span> <span class="fu">length</span>(splitPlan[[fold]]<span class="sc">$</span>app)</span>
<span id="cb218-10"><a href="#cb218-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb218-11"><a href="#cb218-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (fila <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb218-12"><a href="#cb218-12" aria-hidden="true" tabindex="-1"></a>      sum_sizes_validation_sets <span class="ot">&lt;-</span> sum_sizes_validation_sets <span class="sc">+</span> <span class="fu">length</span>(splitPlan[[fold]]<span class="sc">$</span>app)</span>
<span id="cb218-13"><a href="#cb218-13" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb218-14"><a href="#cb218-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb218-15"><a href="#cb218-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb218-16"><a href="#cb218-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-17"><a href="#cb218-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Dividir entre la suma de los tamaños de los 10 conjuntos de validación</span></span>
<span id="cb218-18"><a href="#cb218-18" aria-hidden="true" tabindex="-1"></a>resultados_finales[<span class="st">"AUC_ponderado"</span>] <span class="ot">&lt;-</span> resultados_finales[<span class="st">"AUC_ponderado"</span>] <span class="sc">/</span> sum_sizes_validation_sets</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb219"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(resultados_finales[, <span class="fu">c</span>(<span class="st">"Modelo"</span>, <span class="st">"AUC_ponderado"</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Modelo</th>
<th style="text-align: right;">AUC_ponderado</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Binomial, Link logit</td>
<td style="text-align: right;">0.5402487</td>
</tr>
<tr class="even">
<td style="text-align: left;">Binomial, Link probit</td>
<td style="text-align: right;">0.5402487</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Binomial, Link cloglog</td>
<td style="text-align: right;">0.5402487</td>
</tr>
<tr class="even">
<td style="text-align: left;">Binomial, Link cauchit</td>
<td style="text-align: right;">0.5402487</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Naive Bayes</td>
<td style="text-align: right;">0.5587152</td>
</tr>
<tr class="even">
<td style="text-align: left;">KNN, K = 33</td>
<td style="text-align: right;">0.5345266</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Como modelos de clasificación con mayor <strong>AUC</strong> suelen ser mejores, de la tabla previa concluimos que el modelo <strong>Naive Bayes</strong> tuvo el mejor desempeño entre los seis modelos, seguido por los cuatro modelos de tipo <strong>glm(…)</strong>; y, por último, <strong>KNN</strong>, modelo de menor desempeño.</p>
<p>Estos resultados son consistentes con lo obtenido en la pregunta <strong>g</strong>, puesto que los modelos cuyas curvas ROC estaban más cercanas al punto <span class="math inline">\(\left( 0, 1 \right)\)</span> han sido los mismos que, en esta pregunta, hemos verificado tienen mejor desempeño predictivo.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>